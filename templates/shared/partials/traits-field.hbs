{{!-- 
  Traits Field Component
  
  Usage:
    {{> "systems/avant/templates/shared/partials/traits-field"
        name="system.traits"
        displayTraits=displayTraits
        label="Traits"
        hint="Add traits to categorize this item"
        class="custom-class"
        editable=editable
    }}
  
  Required: name, label, displayTraits
  Optional: hint, class, editable (defaults to true)
--}}

<div class="form-group {{#if class}}{{class}}{{/if}}">
    <label for="{{name}}" class="form-label">
        {{label}}
    </label>
    
    {{#if (ne editable false)}}
        <!-- Edit mode: Trait chip input with autocomplete -->
        <div class="trait-chip-input" data-trait-input="true" {{#if hint}}aria-describedby="{{name}}-hint"{{/if}}>
            <div class="trait-chip-input__field" tabindex="0" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                <!-- Existing trait chips -->
                {{#each displayTraits as |trait|}}
                    <span class="trait-chip trait-chip--removable" 
                          data-trait="{{trait.id}}" 
                          {{traitChipData trait}}
                          style="{{traitChipStyle trait}}"
                          title="{{#if trait.description}}{{trait.description}}{{else}}{{trait.name}}{{/if}}"
                          role="option"
                          aria-selected="true">
                        {{#if trait.icon}}<i class="trait-chip__icon {{trait.icon}}" aria-hidden="true"></i>{{/if}}
                        <span class="trait-chip__text">{{trait.name}}</span>
                        <button type="button" 
                                class="trait-chip__remove" 
                                data-action="removeTrait" 
                                aria-label="Remove {{trait.name}} trait"
                                tabindex="0">Ã—</button>
                    </span>
                {{/each}}
                
                <!-- Input field for adding new traits -->
                <input type="text" 
                       class="trait-chip-input__input" 
                       placeholder="Add trait..." 
                       autocomplete="off"
                       aria-label="Add new trait"
                       role="textbox" />
            </div>
            
            <!-- Dropdown for autocomplete suggestions (hidden by default) -->
            <div class="trait-chip-input__dropdown" 
                 data-trait-dropdown="true" 
                 role="listbox" 
                 aria-label="Trait suggestions">
                <div class="trait-chip-input__no-results" aria-live="polite">
                    No matching traits found
                </div>
            </div>
            
            <!-- Hidden inputs to store actual trait data -->
            {{#each displayTraits as |trait index|}}
                <input type="hidden" name="{{../name}}.{{index}}" value="{{trait.id}}" />
            {{/each}}
        </div>
    {{else}}
        <!-- View mode: Display trait chips (readonly) -->
        <div class="trait-chips trait-chips--readonly" {{#if hint}}aria-describedby="{{name}}-hint"{{/if}}>
            {{#each displayTraits as |trait|}}
                <span class="trait-chip" 
                      data-trait="{{trait.id}}"
                      {{traitChipData trait}}
                      style="{{traitChipStyle trait}}"
                      title="{{#if trait.description}}{{trait.description}}{{else}}{{trait.name}}{{/if}}">
                    {{#if trait.icon}}<i class="trait-chip__icon {{trait.icon}}" aria-hidden="true"></i>{{/if}}
                    <span class="trait-chip__text">{{trait.name}}</span>
                </span>
            {{else}}
                <span class="trait-chips__empty">No traits assigned</span>
            {{/each}}
        </div>
    {{/if}}
    
    {{#if hint}}
        <div id="{{name}}-hint" class="form-hint" role="note">{{hint}}</div>
    {{/if}}
</div> 