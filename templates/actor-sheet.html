<!-- Avant Native Actor Sheet Template - V2 ApplicationV2 -->
<div class="{{cssClass}} flexcol" autocomplete="off" data-actor-id="{{actor.id}}">
    <!-- Fixed Header with Character Name and Avatar -->
    <header class="sheet-header">
        <img class="profile-img" src="{{#if actor.img}}{{actor.img}}{{else}}icons/svg/mystery-man.svg{{/if}}"
            data-edit="img" data-action="editImage" title="{{actor.name}}" role="button" aria-label="Change portrait" />
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Character Name" />
            </h1>
        </div>
        <!-- Character Stats moved to header -->
        <div class="header-stats">
            <div class="header-stat">
                <span class="header-stat-label">Level</span>
                <input type="number" name="system.level" value="{{system.level}}" data-dtype="Number" min="1" max="20"
                    class="header-stat-input show-stepper" />
            </div>
            <div class="header-stat">
                <span class="header-stat-label">Fortune</span>
                <input type="number" name="system.fortunePoints" value="{{system.fortunePoints}}" data-dtype="Number"
                    min="0" class="header-stat-input show-stepper" />
            </div>
        </div>
    </header>

    <!-- Main Layout Container -->
    <div class="sheet-content">
        <!-- Left Sidebar for Stats -->
        <aside class="stats-sidebar">
            <!-- Defense Threshold -->
            <div class="sidebar-section">
                <h4>Defense Threshold</h4>
                <div class="stat-tiles-row">
                    <div class="sidebar-stat-tile">
                        <input type="text" name="system.defenseThreshold" value="{{system.defenseThreshold}}"
                            data-dtype="Number" class="sidebar-input" />
                        <span class="sidebar-stat-tile-label">Defense</span>
                    </div>
                </div>
            </div>

            <!-- Hit Points -->
            <div class="sidebar-section">
                <h4>Hit Points</h4>
                <div class="stat-tiles-row">
                    <div class="sidebar-stat-tile">
                        <input type="text" name="system.health.value" value="{{system.health.value}}"
                            data-dtype="Number" class="sidebar-input" />
                        <span class="sidebar-stat-tile-label">Current</span>
                    </div>
                    <div class="sidebar-stat-tile">
                        <input type="text" name="system.health.max" value="{{system.health.max}}" data-dtype="Number"
                            class="sidebar-input" />
                        <span class="sidebar-stat-tile-label">Max</span>
                    </div>
                    <div class="sidebar-stat-tile">
                        <input type="text" name="system.health.temp" value="{{system.health.temp}}" data-dtype="Number"
                            class="sidebar-input" />
                        <span class="sidebar-stat-tile-label">Temp</span>
                    </div>
                </div>
            </div>

            <!-- Attributes -->
            <div class="sidebar-section">
                <h4>{{localize "avant.attributes"}}</h4>
                <div class="sidebar-attributes">
                    <div class="sidebar-attribute">
                        <label>Might</label>
                        <div class="attribute-input-row">
                            <input type="text" name="system.attributes.might.modifier"
                                value="{{system.attributes.might.modifier}}" data-dtype="Number"
                                class="sidebar-input" />
                        </div>
                    </div>
                    <div class="sidebar-attribute">
                        <label>Grace</label>
                        <div class="attribute-input-row">
                            <input type="text" name="system.attributes.grace.modifier"
                                value="{{system.attributes.grace.modifier}}" data-dtype="Number"
                                class="sidebar-input" />
                        </div>
                    </div>
                    <div class="sidebar-attribute">
                        <label>Intellect</label>
                        <div class="attribute-input-row">
                            <input type="text" name="system.attributes.intellect.modifier"
                                value="{{system.attributes.intellect.modifier}}" data-dtype="Number"
                                class="sidebar-input" />
                        </div>
                    </div>
                    <div class="sidebar-attribute">
                        <label>Focus</label>
                        <div class="attribute-input-row">
                            <input type="text" name="system.attributes.focus.modifier"
                                value="{{system.attributes.focus.modifier}}" data-dtype="Number"
                                class="sidebar-input" />
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Navigation Tabs -->
            <nav class="sheet-tabs tabs" data-group="sheet">
                <a class="item" data-tab="core" data-group="sheet">Core</a>
                <a class="item" data-tab="actions" data-group="sheet">Actions</a>
                <a class="item" data-tab="gear" data-group="sheet">Gear</a>
                <a class="item" data-tab="skills" data-group="sheet">Skills</a>
                <a class="item" data-tab="features" data-group="sheet">Features</a>
                <a class="item" data-tab="talents" data-group="sheet">Talents & Powers</a>
            </nav>

            <!-- Scrollable Content Area -->
            <section class="sheet-body">
                <!-- Core Tab -->
                <div class="tab" data-group="sheet" data-tab="core">
                    <!-- Character Information -->
                    <div class="character-info-section">
                        <h3>Character Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ancestry</label>
                                <select name="system.ancestry">
                                    <option value="">Select Ancestry</option>
                                    <option value="Antherum" {{#if (eq system.ancestry "Antherum" )}}selected{{/if}}>
                                        Antherum</option>
                                    <option value="Cambion" {{#if (eq system.ancestry "Cambion" )}}selected{{/if}}>
                                        Cambion</option>
                                    <option value="Dracycid" {{#if (eq system.ancestry "Dracycid" )}}selected{{/if}}>
                                        Dracycid</option>
                                    <option value="Dworg" {{#if (eq system.ancestry "Dworg" )}}selected{{/if}}>Dworg
                                    </option>
                                    <option value="Elf" {{#if (eq system.ancestry "Elf" )}}selected{{/if}}>Elf</option>
                                    <option value="Fairy" {{#if (eq system.ancestry "Fairy" )}}selected{{/if}}>Fairy
                                    </option>
                                    <option value="Fignette" {{#if (eq system.ancestry "Fignette" )}}selected{{/if}}>
                                        Fignette</option>
                                    <option value="Goblin" {{#if (eq system.ancestry "Goblin" )}}selected{{/if}}>Goblin
                                    </option>
                                    <option value="Human" {{#if (eq system.ancestry "Human" )}}selected{{/if}}>Human
                                    </option>
                                    <option value="Hybrid" {{#if (eq system.ancestry "Hybrid" )}}selected{{/if}}>Hybrid
                                    </option>
                                    <option value="Kryon" {{#if (eq system.ancestry "Kryon" )}}selected{{/if}}>Kryon
                                    </option>
                                    <option value="Lux" {{#if (eq system.ancestry "Lux" )}}selected{{/if}}>Lux</option>
                                    <option value="Mixed" {{#if (eq system.ancestry "Mixed" )}}selected{{/if}}>Mixed
                                    </option>
                                    <option value="Mocro" {{#if (eq system.ancestry "Mocro" )}}selected{{/if}}>Mocro
                                    </option>
                                    <option value="Nephilim" {{#if (eq system.ancestry "Nephilim" )}}selected{{/if}}>
                                        Nephilim</option>
                                    <option value="Oaf" {{#if (eq system.ancestry "Oaf" )}}selected{{/if}}>Oaf</option>
                                    <option value="Orc" {{#if (eq system.ancestry "Orc" )}}selected{{/if}}>Orc</option>
                                    <option value="Shari" {{#if (eq system.ancestry "Shari" )}}selected{{/if}}>Shari
                                    </option>
                                    <option value="Stoich" {{#if (eq system.ancestry "Stoich" )}}selected{{/if}}>Stoich
                                    </option>
                                    <option value="Vivan" {{#if (eq system.ancestry "Vivan" )}}selected{{/if}}>Vivan
                                    </option>
                                    <option value="Wyrd" {{#if (eq system.ancestry "Wyrd" )}}selected{{/if}}>Wyrd
                                    </option>
                                    <option value="Yotun" {{#if (eq system.ancestry "Yotun" )}}selected{{/if}}>Yotun
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Lineage</label>
                                <select name="system.lineage">
                                    <option value="">Select Lineage</option>
                                    <option value="Absolved" {{#if (eq system.lineage "Absolved" )}}selected{{/if}}>
                                        Absolved</option>
                                    <option value="Ancestral" {{#if (eq system.lineage "Ancestral" )}}selected{{/if}}>
                                        Ancestral</option>
                                    <option value="Arcane" {{#if (eq system.lineage "Arcane" )}}selected{{/if}}>Arcane
                                    </option>
                                    <option value="Artisan" {{#if (eq system.lineage "Artisan" )}}selected{{/if}}>
                                        Artisan</option>
                                    <option value="Blue" {{#if (eq system.lineage "Blue" )}}selected{{/if}}>Blue
                                    </option>
                                    <option value="Brownie" {{#if (eq system.lineage "Brownie" )}}selected{{/if}}>
                                        Brownie</option>
                                    <option value="Clay" {{#if (eq system.lineage "Clay" )}}selected{{/if}}>Clay
                                    </option>
                                    <option value="Desert" {{#if (eq system.lineage "Desert" )}}selected{{/if}}>Desert
                                    </option>
                                    <option value="Dhampir" {{#if (eq system.lineage "Dhampir" )}}selected{{/if}}>
                                        Dhampir</option>
                                    <option value="Diamond" {{#if (eq system.lineage "Diamond" )}}selected{{/if}}>
                                        Diamond</option>
                                    <option value="Divine" {{#if (eq system.lineage "Divine" )}}selected{{/if}}>Divine
                                    </option>
                                    <option value="Draconic" {{#if (eq system.lineage "Draconic" )}}selected{{/if}}>
                                        Draconic</option>
                                    <option value="Elemental" {{#if (eq system.lineage "Elemental" )}}selected{{/if}}>
                                        Elemental</option>
                                    <option value="Fey" {{#if (eq system.lineage "Fey" )}}selected{{/if}}>Fey</option>
                                    <option value="Forest" {{#if (eq system.lineage "Forest" )}}selected{{/if}}>Forest
                                    </option>
                                    <option value="Giant" {{#if (eq system.lineage "Giant" )}}selected{{/if}}>Giant
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Culture</label>
                                <input type="text" name="system.culture" value="{{system.culture}}"
                                    placeholder="Character Culture" />
                            </div>
                            <div class="form-group">
                                <label>Vocation</label>
                                <input type="text" name="system.vocation" value="{{system.vocation}}"
                                    placeholder="Character Vocation" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Languages</label>
                            <input type="text" name="system.languages" value="{{system.languages}}"
                                placeholder="Known Languages" />
                        </div>
                    </div>

                    <!-- Biography Section -->
                    <div class="character-info-section">
                        <h3>Biography</h3>
                        <div class="form-group">
                            <label>Character Biography</label>
                            <textarea name="system.biography"
                                placeholder="Character's background, personality, and history...">{{{system.biography}}}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Notes</label>
                            <textarea name="system.notes"
                                placeholder="Additional notes and reminders...">{{{system.notes}}}</textarea>
                        </div>
                    </div>
                </div>




                <!-- Skills Tab -->
                <div class="tab" data-group="sheet" data-tab="skills">
                    <div class="skills-section">
                        <!-- Expertise Points Section -->
                        <!--
                            NOTE ON DUPLICATE PARTIALS:
                            This partial is included here and on the Gear tab. To prevent form submission errors
                            due to duplicate field 'name' attributes, this instance does NOT submit its data.
                            The instance on the Gear tab is passed `submit=true` and is the single source of
                            truth for form data. UI synchronization is handled in actor-sheet.ts.
                        -->
                        {{> "systems/avant/templates/actor/expertise-points-section"}}
                        <!-- 2x2 Grid for Attribute Groups -->
                        <div class="skills-attributes-grid">
                            <!-- Might Skills -->
                            <div class="skills-attribute-section">
                                <h4 class="skills-attribute-header">Might</h4>
                                <div class="skills-attribute-list">
                                    {{#each skillsByAttribute.might as |skill|}}
                                    <div class="skill-tile">
                                        <label>{{skill.label}}</label>
                                        <input type="number" name="system.skills.{{skill.name}}" value="{{skill.value}}"
                                            data-dtype="Number" min="0" max="999" inputmode="numeric" />
                                        <button type="button" class="skill-roll rollable" data-action="rollSkill"
                                            data-skill="{{skill.name}}"
                                            title="Roll {{skill.label}} (2d10+Level+Attribute+Skill)">
                                            {{#if (gt skill.totalModifier 0)}}+{{/if}}{{skill.totalModifier}}
                                        </button>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>

                            <!-- Grace Skills -->
                            <div class="skills-attribute-section">
                                <h4 class="skills-attribute-header">Grace</h4>
                                <div class="skills-attribute-list">
                                    {{#each skillsByAttribute.grace as |skill|}}
                                    <div class="skill-tile">
                                        <label>{{skill.label}}</label>
                                        <input type="number" name="system.skills.{{skill.name}}" value="{{skill.value}}"
                                            data-dtype="Number" min="0" max="999" inputmode="numeric" />
                                        <button type="button" class="skill-roll rollable" data-action="rollSkill"
                                            data-skill="{{skill.name}}"
                                            title="Roll {{skill.label}} (2d10+Level+Attribute+Skill)">
                                            {{#if (gt skill.totalModifier 0)}}+{{/if}}{{skill.totalModifier}}
                                        </button>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>

                            <!-- Intellect Skills -->
                            <div class="skills-attribute-section">
                                <h4 class="skills-attribute-header">Intellect</h4>
                                <div class="skills-attribute-list">
                                    {{#each skillsByAttribute.intellect as |skill|}}
                                    <div class="skill-tile">
                                        <label>{{skill.label}}</label>
                                        <input type="number" name="system.skills.{{skill.name}}" value="{{skill.value}}"
                                            data-dtype="Number" min="0" max="999" inputmode="numeric" />
                                        <button type="button" class="skill-roll rollable" data-action="rollSkill"
                                            data-skill="{{skill.name}}"
                                            title="Roll {{skill.label}} (2d10+Level+Attribute+Skill)">
                                            {{#if (gt skill.totalModifier 0)}}+{{/if}}{{skill.totalModifier}}
                                        </button>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>

                            <!-- Focus Skills -->
                            <div class="skills-attribute-section">
                                <h4 class="skills-attribute-header">Focus</h4>
                                <div class="skills-attribute-list">
                                    {{#each skillsByAttribute.focus as |skill|}}
                                    <div class="skill-tile">
                                        <label>{{skill.label}}</label>
                                        <input type="number" name="system.skills.{{skill.name}}" value="{{skill.value}}"
                                            data-dtype="Number" min="0" max="999" inputmode="numeric" />
                                        <button type="button" class="skill-roll rollable" data-action="rollSkill"
                                            data-skill="{{skill.name}}"
                                            title="Roll {{skill.label}} (2d10+Level+Attribute+Skill)">
                                            {{#if (gt skill.totalModifier 0)}}+{{/if}}{{skill.totalModifier}}
                                        </button>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gear Tab -->
                <div class="tab" data-group="sheet" data-tab="gear">
                    <!--
                        NOTE ON DUPLICATE PARTIALS:
                        This partial is the single source of truth for Expertise Points form data.
                        It is passed `submit=true` which enables the 'name' attributes on its inputs.
                        The instance on the Skills tab omits this parameter and does not submit data.
                        UI synchronization is handled in actor-sheet.ts.
                    -->
                    {{> "systems/avant/templates/actor/expertise-points-section" submit=true}}

                    <!-- Weapons Section -->
                    {{> "systems/avant/templates/shared/partials/items-section"
                    title="Weapons"
                    itemType="weapon"
                    items=cardLayouts.weapon
                    cssClass="weapon-cards"}}

                    <!-- Armor Section -->
                    {{> "systems/avant/templates/shared/partials/items-section"
                    title="Armor"
                    itemType="armor"
                    items=cardLayouts.armor
                    cssClass="armor-cards"}}

                    <!-- Equipment & Gear Section -->
                    {{> "systems/avant/templates/shared/partials/items-section"
                    title="Equipment & Gear"
                    itemType="gear"
                    items=cardLayouts.gear
                    cssClass="gear-cards"}}
                </div>

                <!-- Actions Tab (Unified) -->
                <div class="tab" data-group="sheet" data-tab="actions">
                    {{> "systems/avant/templates/shared/partials/actions-section" unifiedActions=unifiedActions}}
                </div>

                <!-- Features Tab -->
                <div class="tab" data-group="sheet" data-tab="features">
                    {{> "systems/avant/templates/shared/partials/items-section"
                    title="Features"
                    itemType="feature"
                    items=cardLayouts.feature
                    cssClass="feature-cards"}}
                </div>

                <!-- Talents & Augments Tab -->
                <div class="tab" data-group="sheet" data-tab="talents">
                    <!-- Power Points Section -->
                    {{> "systems/avant/templates/actor/power-points-section"}}

                    <!-- Talents Section -->
                    {{> "systems/avant/templates/shared/partials/items-section"
                    title="Talents"
                    itemType="talent"
                    items=cardLayouts.talent
                    cssClass="talent-cards"}}

                    <!-- Augments Section -->
                    {{> "systems/avant/templates/shared/partials/items-section"
                    title="Augments"
                    itemType="augment"
                    items=cardLayouts.augment
                    cssClass="augment-cards"}}
                </div>
            </section>
        </main>
    </div>
</div>