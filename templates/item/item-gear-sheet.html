<!-- Gear Item Sheet Template -->
<div class="{{cssClass}} flexcol" autocomplete="off">
    <header class="sheet-header">
        <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" height="64" width="64"/>
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Gear Name"/></h1>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="description">Description</a>
        <a class="item" data-tab="details">Details</a>
    </nav>

    <section class="sheet-body">
        <div class="tab" data-group="primary" data-tab="description">
            <div class="form-group">
                <label>Description</label>
                <textarea name="system.description" rows="8">{{system.description}}</textarea>
            </div>
            
            <!-- Trait Management Section -->
            <div class="form-group">
                <label>Traits</label>
                {{#if editable}}
                    <!-- Edit mode: Trait chip input -->
                    <div class="trait-chip-input" data-trait-input="true">
                        <div class="trait-chip-input__field" tabindex="0">
                            <!-- Existing trait chips -->
                            {{#each displayTraits as |trait|}}
                                <span class="trait-chip trait-chip--removable" data-trait="{{trait.id}}" 
                                      {{traitChipData trait}}
                                      style="{{traitChipStyle trait}}"
                                      title="{{#if trait.description}}{{trait.description}}{{else}}{{trait.name}}{{/if}}">
                                    {{#if trait.icon}}<i class="trait-chip__icon {{trait.icon}}" aria-hidden="true"></i>{{/if}}
                                    <span class="trait-chip__text">{{trait.name}}</span>
                                    <button type="button" class="trait-chip__remove" aria-label="Remove trait">Ã—</button>
                                </span>
                            {{/each}}
                            <!-- Input field for adding new traits -->
                            <input type="text" class="trait-chip-input__input" placeholder="Add trait..." autocomplete="off" />
                        </div>
                        <!-- Dropdown for autocomplete suggestions (hidden by default) -->
                        <div class="trait-chip-input__dropdown" data-trait-dropdown="true">
                            <div class="trait-chip-input__no-results">No matching traits found</div>
                        </div>
                        <!-- Hidden input to store actual trait data -->
                        <input type="hidden" name="system.traits" value="{{json system.traits}}" data-trait-data="true" />
                    </div>
                {{else}}
                    <!-- View mode: Display trait chips -->
                    <div class="trait-chips trait-chips--readonly">
                        {{#each displayTraits as |trait|}}
                            <span class="trait-chip" data-trait="{{trait.id}}"
                                  {{traitChipData trait}}
                                  style="{{traitChipStyle trait}}"
                                  title="{{#if trait.description}}{{trait.description}}{{else}}{{trait.name}}{{/if}}">
                                {{#if trait.icon}}<i class="trait-chip__icon {{trait.icon}}" aria-hidden="true"></i>{{/if}}
                                <span class="trait-chip__text">{{trait.name}}</span>
                            </span>
                        {{else}}
                            <span class="trait-chips__empty">No traits assigned</span>
                        {{/each}}
                    </div>
                {{/if}}
            </div>
        </div>

        <div class="tab" data-group="primary" data-tab="details">
            <div class="form-group">
                <label>Type</label>
                <input type="text" name="type" value="gear" readonly/>
            </div>
        </div>
    </section>
</div>