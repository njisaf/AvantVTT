<form class="{{cssClass}} flexcol" autocomplete="off">
    <header class="sheet-header">
        <img class="profile-img" src="{{#if item.img}}{{item.img}}{{else}}icons/svg/clockwork.svg{{/if}}" data-edit="img" title="{{item.name}}" height="64" width="64"/>
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Augment Name"/></h1>
            <div class="resource-row">
                <div class="resource">
                    <label for="system.rarity">Rarity</label>
                    <select name="system.rarity">
                        <option value="common" {{#if (eq system.rarity "common")}}selected{{/if}}>Common</option>
                        <option value="uncommon" {{#if (eq system.rarity "uncommon")}}selected{{/if}}>Uncommon</option>
                        <option value="rare" {{#if (eq system.rarity "rare")}}selected{{/if}}>Rare</option>
                        <option value="epic" {{#if (eq system.rarity "epic")}}selected{{/if}}>Epic</option>
                        <option value="legendary" {{#if (eq system.rarity "legendary")}}selected{{/if}}>Legendary</option>
                    </select>
                </div>
                <div class="resource">
                    <label for="system.isActive">Is Active</label>
                    <input type="checkbox" name="system.isActive" {{#if system.isActive}}checked{{/if}}/>
                </div>
            </div>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="description">Description</a>
        <a class="item" data-tab="details">Details</a>
    </nav>

    <section class="sheet-body">
        <div class="tab" data-group="primary" data-tab="description">
            <div class="form-group">
                <label>Description</label>
                <textarea name="system.description" rows="10">{{system.description}}</textarea>
            </div>
            
            <!-- Trait Management Section -->
            <div class="form-group">
                <label>Traits</label>
                {{#if editable}}
                    <!-- Edit mode: Trait chip input -->
                    <div class="trait-chip-input" data-trait-input="true">
                        <div class="trait-chip-input__field" tabindex="0">
                            <!-- Existing trait chips -->
                            {{#each displayTraits as |trait|}}
                                <span class="trait-chip trait-chip--removable" data-trait="{{trait.id}}" 
                                      {{traitChipData trait}}
                                      style="{{traitChipStyle trait}}"
                                      title="{{#if trait.description}}{{trait.description}}{{else}}{{trait.name}}{{/if}}">
                                    {{#if trait.icon}}<i class="trait-chip__icon {{trait.icon}}" aria-hidden="true"></i>{{/if}}
                                    <span class="trait-chip__text">{{trait.name}}</span>
                                    <button type="button" class="trait-chip__remove" aria-label="Remove trait">Ã—</button>
                                </span>
                            {{/each}}
                            <!-- Input field for adding new traits -->
                            <input type="text" class="trait-chip-input__input" placeholder="Add trait..." autocomplete="off" />
                        </div>
                        <!-- Dropdown for autocomplete suggestions (hidden by default) -->
                        <div class="trait-chip-input__dropdown" data-trait-dropdown="true">
                            <div class="trait-chip-input__no-results">No matching traits found</div>
                        </div>
                        <!-- Hidden input to store actual trait data -->
                        <input type="hidden" name="system.traits" value="{{json system.traits}}" data-trait-data="true" />
                    </div>
                {{else}}
                    <!-- View mode: Display trait chips -->
                    <div class="trait-chips trait-chips--readonly">
                        {{#each displayTraits as |trait|}}
                            <span class="trait-chip" data-trait="{{trait.id}}">
                                <span class="trait-chip__text">{{trait.name}}</span>
                            </span>
                        {{else}}
                            <span class="trait-chips__empty">No traits assigned</span>
                        {{/each}}
                    </div>
                {{/if}}
            </div>
        </div>

        <div class="tab" data-group="primary" data-tab="details">
            <div class="form-group">
                <label>Prerequisites</label>
                <input type="text" name="system.prerequisites" value="{{system.prerequisites}}" placeholder="Any prerequisites for this augment"/>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="system.uses.value">Current Uses</label>
                    <input type="number" name="system.uses.value" value="{{system.uses.value}}" data-dtype="Number" min="0"/>
                </div>
                <div class="form-group">
                    <label for="system.uses.max">Maximum Uses</label>
                    <input type="number" name="system.uses.max" value="{{system.uses.max}}" data-dtype="Number" min="0"/>
                </div>
            </div>
            
            <div class="form-group">
                <label>Augment Type</label>
                <select name="system.augmentType">
                    <option value="enhancement" {{#if (eq system.augmentType "enhancement")}}selected{{/if}}>Enhancement</option>
                    <option value="modification" {{#if (eq system.augmentType "modification")}}selected{{/if}}>Modification</option>
                    <option value="implant" {{#if (eq system.augmentType "implant")}}selected{{/if}}>Implant</option>
                    <option value="symbiotic" {{#if (eq system.augmentType "symbiotic")}}selected{{/if}}>Symbiotic</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Power Point Cost</label>
                <input type="number" name="system.powerPointCost" value="{{system.powerPointCost}}" data-dtype="Number" min="0"/>
            </div>
        </div>
    </section>
</form> 