<!-- Weapon Item Sheet Template -->
<form class="{{cssClass}} flexcol" autocomplete="off">
    <header class="sheet-header">
        <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" height="64" width="64"/>
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Weapon Name"/></h1>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="description">Description</a>
        <a class="item" data-tab="details">Details</a>
    </nav>

    <section class="sheet-body">
        <div class="tab" data-group="primary" data-tab="description">
            <div class="form-group">
                <label>Description</label>
                <textarea name="system.description" rows="8">{{system.description}}</textarea>
            </div>
            
            <!-- Trait Management Section -->
            <div class="form-group">
                <label>Traits</label>
                {{#if editable}}
                    <!-- Edit mode: Trait chip input -->
                    <div class="trait-chip-input" data-trait-input="true">
                        <div class="trait-chip-input__field" tabindex="0">
                            <!-- Existing trait chips -->
                            {{#each displayTraits as |trait|}}
                                <span class="trait-chip trait-chip--removable" data-trait="{{trait.id}}" 
                                      {{traitChipData trait}}
                                      style="{{traitChipStyle trait}}"
                                      title="{{#if trait.description}}{{trait.description}}{{else}}{{trait.name}}{{/if}}">
                                    {{#if trait.icon}}<i class="trait-chip__icon {{trait.icon}}" aria-hidden="true"></i>{{/if}}
                                    <span class="trait-chip__text">{{trait.name}}</span>
                                    <button type="button" class="trait-chip__remove" aria-label="Remove trait">Ã—</button>
                                </span>
                            {{/each}}
                            <!-- Input field for adding new traits -->
                            <input type="text" class="trait-chip-input__input" placeholder="Add trait..." autocomplete="off" />
                        </div>
                        <!-- Dropdown for autocomplete suggestions (hidden by default) -->
                        <div class="trait-chip-input__dropdown" data-trait-dropdown="true">
                            <div class="trait-chip-input__no-results">No matching traits found</div>
                        </div>
                        <!-- Hidden input to store actual trait data -->
                        <input type="hidden" name="system.traits" value="{{json system.traits}}" data-trait-data="true" />
                    </div>
                {{else}}
                    <!-- View mode: Display trait chips -->
                    <div class="trait-chips trait-chips--readonly">
                        {{#each displayTraits as |trait|}}
                            <span class="trait-chip" data-trait="{{trait.id}}"
                                  {{traitChipData trait}}
                                  style="{{traitChipStyle trait}}"
                                  title="{{#if trait.description}}{{trait.description}}{{else}}{{trait.name}}{{/if}}">
                                {{#if trait.icon}}<i class="trait-chip__icon {{trait.icon}}" aria-hidden="true"></i>{{/if}}
                                <span class="trait-chip__text">{{trait.name}}</span>
                            </span>
                        {{else}}
                            <span class="trait-chips__empty">No traits assigned</span>
                        {{/each}}
                    </div>
                {{/if}}
            </div>
        </div>

        <div class="tab" data-group="primary" data-tab="details">
            <div class="form-group">
                <label>Ability</label>
                <select name="system.ability">
                    <option value="might" {{#if (eq system.ability "might")}}selected{{/if}}>Might</option>
                    <option value="grace" {{#if (eq system.ability "grace")}}selected{{/if}}>Grace</option>
                    <option value="intellect" {{#if (eq system.ability "intellect")}}selected{{/if}}>Intellect</option>
                    <option value="focus" {{#if (eq system.ability "focus")}}selected{{/if}}>Focus</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Modifier</label>
                <input type="number" name="system.modifier" value="{{system.modifier}}" placeholder="0"/>
            </div>
            
            <div class="form-group">
                <label>Damage Die</label>
                <input type="text" name="system.damageDie" value="{{system.damageDie}}" placeholder="1d6"/>
            </div>
            
            <div class="form-group">
                <label>Damage Type</label>
                <input type="text" name="system.damageType" value="{{system.damageType}}" placeholder="Slashing"/>
            </div>
            
            <div class="form-group">
                <label>Range</label>
                <input type="text" name="system.range" value="{{system.range}}" placeholder="Melee"/>
            </div>
            
            <div class="form-group">
                <label>Properties</label>
                <input type="text" name="system.properties" value="{{system.properties}}" placeholder="Special properties"/>
            </div>
            
            <div class="form-group">
                <label>Weight</label>
                <input type="number" name="system.weight" value="{{system.weight}}" step="0.1" placeholder="1"/>
            </div>
            
            <div class="form-group">
                <label>Cost</label>
                <input type="number" name="system.cost" value="{{system.cost}}" placeholder="0"/>
            </div>
        </div>
    </section>
</form>