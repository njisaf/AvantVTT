<!-- Base Item Sheet Template for Avant VTT System -->
<!-- 
    This template provides the architectural foundation for all item sheets.
    It uses a flexible grid-first layout with conditional widgets and tabs.
    
    Phase 1: Architectural Skeleton
    - Basic form structure with proper ARIA support
    - Conditional widget rendering based on item type  
    - Grid-first layout for responsive design
    - Tab system skeleton with proper accessibility
    
    Future Phases will extend this with:
    - Component library widgets
    - Advanced validation
    - Enhanced accessibility features
-->

<div class="{{cssClass}} flexcol" data-application-part="form" autocomplete="off" aria-label="{{title}}">
    
    <!-- Sheet Header -->
    <header class="item-sheet__header" role="banner">
        <div class="item-sheet__header-main">
            <!-- Image Upload (conditional) -->
            {{#if widgets.imageUpload}}
                <div class="item-sheet__image">
                    <img class="item-sheet__profile-img" 
                         src="{{item.img}}" 
                         data-edit="img" 
                         title="{{item.name}}" 
                         alt="{{item.name}} image"
                         height="64" 
                         width="64"/>
                </div>
            {{/if}}
            
            <!-- Name Field -->
            <div class="item-sheet__name-field">
                <h1 class="item-sheet__name">
                    <label for="item-name" class="sr-only">Item Name</label>
                    <input id="item-name"
                           name="name" 
                           type="text" 
                           value="{{item.name}}" 
                           placeholder="{{#if item.type}}{{titleCase item.type}}{{else}}Item{{/if}} Name"
                           required
                           aria-describedby="item-name-hint"/>
                    <div id="item-name-hint" class="sr-only">Enter the name for this {{item.type}}</div>
                </h1>
            </div>
        </div>
        
        <!-- Header Costs (conditional) -->
        {{#if (or widgets.apSelector widgets.ppCostInput)}}
            <div class="item-sheet__header-costs">
                <!-- AP Selector Widget -->
                {{#if widgets.apSelector}}
                    <div class="item-sheet__ap-selector" 
                         data-ap-cost="{{system.apCost}}" 
                         role="radiogroup" 
                         aria-label="Action Point cost: {{system.apCost}}">
                        <label class="item-sheet__ap-label">AP</label>
                        <div class="item-sheet__ap-icons">
                            {{#each (range 1 4) as |value|}}
                                <button type="button" 
                                        class="item-sheet__ap-icon" 
                                        data-ap-value="{{value}}" 
                                        title="Set AP cost to {{value}}" 
                                        aria-label="Set Action Point cost to {{value}}" 
                                        role="radio"
                                        {{#if (eq ../system.apCost value)}}aria-checked="true"{{else}}aria-checked="false"{{/if}}>
                                    <i class="fas fa-circle" aria-hidden="true"></i>
                                </button>
                            {{/each}}
                        </div>
                        <input type="hidden" 
                               name="system.apCost" 
                               value="{{#if system.apCost}}{{system.apCost}}{{else}}0{{/if}}" 
                               data-dtype="Number">
                    </div>
                {{/if}}
                
                <!-- PP Cost Input Widget -->
                {{#if widgets.ppCostInput}}
                    <div class="item-sheet__pp-cost">
                        <label for="pp-cost-input">PP</label>
                        <input id="pp-cost-input"
                               type="number" 
                               name="system.ppCost" 
                               value="{{system.ppCost}}" 
                               data-dtype="Number" 
                               min="0" 
                               placeholder="0"
                               aria-describedby="pp-cost-hint"/>
                        <div id="pp-cost-hint" class="sr-only">Power Point cost for this {{item.type}}</div>
                    </div>
                {{/if}}
            </div>
        {{/if}}
    </header>

    <!-- Tab Navigation (conditional) -->
    {{#if (gt tabs.length 1)}}
        <nav class="item-sheet__tabs" role="tablist" aria-label="Item sections">
            {{#each tabs as |tab index|}}
                <button class="item-sheet__tab {{#if tab.active}}item-sheet__tab--active{{/if}}" 
                        role="tab"
                        aria-selected="{{#if tab.active}}true{{else}}false{{/if}}"
                        aria-controls="tab-{{tab.id}}"
                        id="tab-button-{{tab.id}}"
                        data-tab="{{tab.id}}"
                        data-group="primary"
                        tabindex="{{#if tab.active}}0{{else}}-1{{/if}}">
                    {{#if tab.icon}}<i class="{{tab.icon}}" aria-hidden="true"></i>{{/if}}
                    <span class="item-sheet__tab-label">{{tab.label}}</span>
                </button>
            {{/each}}
        </nav>
    {{/if}}

    <!-- Sheet Body -->
    <section class="item-sheet__body" role="main">
        {{#if (gt tabs.length 1)}}
            <!-- Multi-tab content -->
            {{#each tabs as |tab|}}
                <div class="item-sheet__tab-content {{#unless tab.active}}item-sheet__tab-content--hidden{{/unless}}" 
                     id="tab-{{tab.id}}"
                     role="tabpanel"
                     aria-labelledby="tab-button-{{tab.id}}"
                     {{#unless tab.active}}aria-hidden="true"{{/unless}}>
                    
                    {{#if (eq tab.id "description")}}
                        {{> "systems/avant/templates/shared/partials/description-tab.hbs"}}
                    {{else if (eq tab.id "details")}}
                        {{> "systems/avant/templates/shared/partials/details-tab.hbs"}}
                    {{else}}
                        <!-- Custom tab content placeholder -->
                        <div class="item-sheet__custom-tab" data-tab-id="{{tab.id}}">
                            <p class="item-sheet__placeholder">Custom tab content for {{tab.label}} will be implemented in Phase 2.</p>
                        </div>
                    {{/if}}
                </div>
            {{/each}}
        {{else}}
            <!-- Single content section (no tabs) -->
            <div class="item-sheet__single-content">
                {{#> "systems/avant/templates/shared/partials/single-content.hbs"}}
                    {{!-- Default single content layout for items without tabs --}}
                    {{> "systems/avant/templates/shared/partials/textarea-field.hbs" 
                        name="system.description" 
                        value=system.description 
                        label="Description" 
                        placeholder="Describe this item..." 
                        rows=6 
                        hint="Detailed description of the item" 
                        class="item-description"}}
                    
                    {{> "systems/avant/templates/shared/partials/traits-field.hbs" 
                        name="system.traits" 
                        displayTraits=displayTraits 
                        label="Traits" 
                        hint="Add traits to categorize this item" 
                        editable=editable 
                        class="item-traits"}}
                {{/"systems/avant/templates/shared/partials/single-content.hbs"}}
            </div>
        {{/if}}
    </section>

    <!-- Debug Information (development only) -->
    {{#if @root.debugMode}}
        <footer class="item-sheet__debug" role="contentinfo">
            <details class="item-sheet__debug-details">
                <summary class="item-sheet__debug-summary">üèó Debug Information</summary>
                <dl class="item-sheet__debug-list">
                    <dt>Sheet Class:</dt>
                    <dd>{{debugInfo.sheetClass}}</dd>
                    <dt>Item Type:</dt>
                    <dd>{{debugInfo.itemType}}</dd>
                    <dt>CSS Classes:</dt>
                    <dd>{{debugInfo.cssClass}}</dd>
                    <dt>Active Widgets:</dt>
                    <dd>{{json debugInfo.widgets}}</dd>
                    <dt>Tab Configuration:</dt>
                    <dd>{{json debugInfo.tabs}}</dd>
                </dl>
            </details>
        </footer>
    {{/if}}
</div>

<!-- ============================================================================ -->
<!-- TEMPLATE DOCUMENTATION -->
<!-- ============================================================================ -->
<!-- 
    ACCESSIBILITY FEATURES:
    - Proper ARIA roles and labels throughout
    - Screen reader friendly field descriptions
    - Keyboard navigation support for tabs and form fields
    - Semantic HTML structure (header, nav, main, footer)
    
    WIDGET SYSTEM:
    - Conditional rendering based on widgets.* context variables
    - Consistent ARIA patterns across all widgets
    - Data attributes for JavaScript interaction
    - Proper form field association with labels
    
    RESPONSIVE DESIGN:
    - Grid-first layout using CSS Grid and Flexbox
    - Flexible header with conditional sections
    - Tab system that adapts to content
    - Mobile-friendly touch targets
    
    FUTURE EXTENSIBILITY:
    - Partial template system for tab content
    - Widget configuration driven by context
    - Debug mode for development
    - Placeholder system for custom content
    
    PHASE 2 INTEGRATION POINTS:
    - Component library widgets will replace basic HTML
    - Validation system will add error displays
    - Storybook macros will use debug information
    - Advanced theming will use CSS custom properties
--> 